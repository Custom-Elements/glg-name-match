<!doctype html>

<html>
  <head>
    <title>glg-name-match</title>
    <script src="node_modules/webcomponents.js/webcomponents.js"></script>
    <link rel="import" href="https://services.glgresearch.com/ui-toolkit/polymer.html">
    <link rel="import" href="https://services.glgresearch.com/ui-toolkit/ui-toolkit.html">
    <link rel="import" href="src/glg-name-match.html">
    <style>
      body {
        font-family: "Helvetica Neue", "Helvetica", "Arial";
        color: #454545;
      }
      ui-typeahead {
        width: 30em;
      }
    </style>
  </head>
  <body container unresolved>
    <h1>glg-name-match demo</h1>
    <div id="myNectarDemo" tile style="margin: 20px 0px 10px 10px;">
      <!-- name-match adapter with custom options set -->
      <glg-name-match
          url="services.glgresearch.com/cerca"
          indices="employees"
          minScore="0.5"
          size="10"
          >
      </glg-name-match>
      <ui-typeahead
          id="omni"
          icon="fa-search"
          placeholder="Type employee name..."
          sticky
          debounce="200">
        <icon search></icon>
        <template value>
          <value>
            <strong>{{name}}</strong>
          </value>
        </template>

        <!-- dynamically templated items in the selection list -->
        <!-- assumes results are interleaved, not grouped by entity -->
        <template id="foo" repeat="{{hits}}" ng-non-bindable>
          <ui-typeahead-item>
          <span><strong>{{_source.name}}</strong>, <i>{{_source.title}}</i> (&nbsp;ID:{{_source.councilMemberId}}&nbsp;)</span>
          </ui-typeahead-item>
        </template>
      </ui-typeahead>
    </div>
    <script>
      document.addEventListener('polymer-ready', function() {
        //poke your element here
        var demo = document.querySelector('div#myNectarDemo');
        var nameMatch = demo.querySelector('glg-name-match');
        var template = demo.querySelector('#foo');

        demo.addEventListener('inputchange', function(evt) {
          if (typeof evt.detail.value !== 'undefined') {
            if (isNaN(evt.detail.value)) {
              nameMatch.query(evt.detail.value);
            }
            else {
              nameMatch.jump(evt.detail.value);
            }
            Platform.performMicrotaskCheckpoint();
            console.log("nameMatch query fired", evt);
          }
        });

        demo.addEventListener('name-match-results', function(evt) {
          template.model = evt.detail;
          Platform.performMicrotaskCheckpoint();
          console.log("template model updated", template.model);
        });
      });
    </script>
  </body>
</html>
